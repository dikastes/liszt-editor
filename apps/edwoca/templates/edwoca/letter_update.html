{% extends 'edwoca/base.html' %}

{% load i18n %}

{% block content %}
<h2 class="my-5">Brief bearbeiten</h2>

<form id="form" method="post" class="mt-5">
    {% csrf_token %}
    {{ form.as_daisy }}
    <input type="submit" value="Speichern" class="hidden" id="submit-form">
</form>

<h3>Absender</h3>

<div class="flex gap-5 my-5">
    {% if object.sender_person %}
        <div class="flex-1  min-w-0">
            <div class="flex">
                <label class="pseudo-input border-r-0 border min-w-0 border-black flex-1 flex items-center gap-2">
                    <span class="flex-0"> {% translate 'person' %} </span>
                    <input type="text" class="flex-1 truncate min-w-0 cursor-not-allowed" disabled value="{{ object.sender_person }}" />
                </label>
                <a class="btn flex-0 btn-outline border-black" href="{% url 'edwoca:letter_remove_sender_person' object.id %}">{% translate 'remove' %}</a>
            </div>
        </div>
    {% else %}
        <div class="flex-1 min-w-0">
            <form method="get" class="flex m-0">
                <label class="input input-bordered bg-white border-r-0 border-black flex items-center gap-2 min-w-0 flex-1">
                    {% translate 'person' %}
                    <input type="text" name="sender_person-q" class="grow" {% if query_sender_person %}value="{{ query_sender_person }}"{% endif %}>
                </label>
                <input type="submit" class="btn flex-0 btn-outline border-black" value="{% translate 'search' %}"/>
            </form>
            {% if query_sender_person %}
                <ul class="border border-black p-2 h-32 overflow-auto">
                {% for person in found_sender_persons %}
                    <li>
                        <a href="{% url 'edwoca:letter_add_sender_person' object.id person.pk %}">{{ person.object }}</a>
                    </li>
                {% empty %}
                    <li> {% translate 'no search results' %} </li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}
    {% if object.sender_corporation %}
        <div class="flex-1 min-w-0 ">
            <div class="flex">
                <label class="pseudo-input min-w-0 border-r-0 border border-black flex-1 flex items-center gap-2">
                    <span class="flex-0">{% translate 'corporation' %}</span>
                    <input type="text" class="grow cursor-not-allowed flex-1 min-w-0 truncate" disabled value="{{ object.sender_corporation }}" />
                </label>
                <a class="btn flex-0 btn-outline border-black" href="{% url 'edwoca:letter_remove_sender_corporation' object.id %}">{% translate 'remove' %}</a>
            </div>
        </div>
    {% else %}
        <div class="flex-1 min-w-0">
            <form method="get" class="flex m-0">
                <label class="input input-bordered bg-white border-r-0 border-black flex items-center gap-2 flex-1 min-w-0">
                    {% translate 'corporation' %}
                    <input type="text" name="sender_corporation-q" class="grow" {% if query_sender_corporation %}value="{{ query_sender_corporation }}"{% endif %}>
                </label>
                <input type="submit" class="btn flex-0 btn-outline border-black" value="{% translate 'search' %}"/>
            </form>
            {% if query_sender_corporation %}
                <ul class="border border-black p-2 h-32 overflow-auto">
                {% for person in found_sender_corporations %}
                    <li>
                        <a href="{% url 'edwoca:letter_add_sender_corporation' object.id person.pk %}">{{ person.object }}</a>
                    </li>
                {% empty %}
                    <li>Keine Suchergebnisse</li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}
</div>

<h3>Empf√§nger</h3>

<div class="flex gap-5 my-5">
    {% if object.receiver_person %}
        <div class="flex-1 min-w-0 flex">
            <div class="flex">
                <label class="pseudo-input cursor-not-allowed border-r-0 border border-black flex-1 min-w-0 flex items-center gap-2">
                    <span class="flex-0"> {% translate 'person' %} </span>
                    <input type="text" class="grow cursor-not-allowed flex-1 min-w-0 truncate" disabled value="{{ object.receiver_person }}" />
                </label>
                <a class="btn flex-0 btn-outline border-black" href="{% url 'edwoca:letter_remove_receiver_person' object.id %}">{% translate 'remove' %}</a>
            </div>
        </div>
    {% else %}
        <div class="flex-1 min-w-0">
            <form method="get" class="flex m-0">
                <label class="input input-bordered bg-white border-r-0 border-black flex items-center gap-2 flex-1 min-w-0">
                    {% translate 'person' %}
                    <input type="text" name="receiver_person-q" class="grow" {% if query_receiver_person %}value="{{ query_receiver_person }}"{% endif %}>
                </label>
                <input type="submit" class="btn flex-0 btn-outline border-black" value="{% translate 'search' %}"/>
            </form>
            {% if query_receiver_person %}
                <ul class="border border-black p-2 h-32 overflow-auto">
                {% for person in found_receiver_persons %}
                    <li>
                        <a href="{% url 'edwoca:letter_add_receiver_person' object.id person.pk %}">{{ person.object }}</a>
                    </li>
                {% empty %}
                    <li> {% translate 'no search results' %} </li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}
    {% if object.receiver_corporation %}
        <div class="flex-1 min-w-0">
            <div class="flex">
                <label class="pseudo-input cursor-not-allowed border-r-0 border border-black flex-1 min-w-0 flex items-center gap-2">
                    <span class="flex-0"> {% translate 'corporation' %} </span>
                    <input type="text" class="grow cursor-not-allowed flex-1 min-w-0 truncate" disabled value="{{ object.receiver_corporation }}" />
                </label>
                <a class="btn flex-0 btn-outline border-black" href="{% url 'edwoca:letter_remove_receiver_corporation' object.id %}">{% translate 'remove' %}</a>
            </div>
        </div>
    {% else %}
        <div class="flex-1 min-w-0">
            <form method="get" class="flex m-0">
                <label class="input input-bordered bg-white border-r-0 border-black flex items-center gap-2 flex-1 min-w-0">
                    {% translate 'corporation' %}
                    <input type="text" name="receiver_corporation-q" class="grow" {% if query_receiver_corporation %}value="{{ query_receiver_corporation }}"{% endif %}>
                </label>
                <input type="submit" class="btn flex-0 btn-outline border-black" value="{% translate 'search' %}"/>
            </form>
            {% if query_receiver_corporation %}
                <ul class="border border-black p-2 h-32 overflow-auto">
                {% for person in found_receiver_corporations %}
                    <li>
                        <a href="{% url 'edwoca:letter_add_receiver_corporation' object.id person.pk %}">{{ person.object }}</a>
                    </li>
                {% empty %}
                    <li>Keine Suchergebnisse</li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}
</div>

<h3>Orte</h3>

<div class="flex gap-5 my-5">
    {% if object.sender_place %}
        <div class="flex-1 min-w-0">
            <div class="flex">
                <label class="pseudo-input cursor-not-allowed border-r-0 border border-black flex-1 min-w-0 flex items-center gap-2">
                    <span class="flex-0"> {% translate 'place (sender)' %} </span>
                    <input type="text" class="grow cursor-not-allowed flex-1 min-w-0 truncate" disabled value="{{ object.sender_place }}" />
                </label>
                <a class="btn flex-0 btn-outline border-black" href="{% url 'edwoca:letter_remove_sender_place' object.id %}">{% translate 'remove' %}</a>
            </div>
        </div>
    {% else %}
        <div class="flex-1 min-w-0">
            <form method="get" class="flex m-0">
                <label class="input input-bordered bg-white border-r-0 border-black flex items-center gap-2 flex-1 min-w-0">
                    {% translate 'place (sender)' %}
                    <input type="text" name="sender_place-q" class="grow" {% if query_sender_place %}value="{{ query_sender_place }}"{% endif %}>
                </label>
                <input type="submit" class="btn flex-0 btn-outline border-black" value="{% translate 'search' %}"/>
            </form>
            {% if query_sender_place %}
                <ul class="border border-black p-2 h-32 overflow-auto">
                {% for person in found_sender_places %}
                    <li>
                        <a href="{% url 'edwoca:letter_add_sender_place' object.id person.pk %}">{{ person.object }}</a>
                    </li>
                {% empty %}
                    <li> {% translate 'no search results' %} </li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}
    {% if object.receiver_place %}
        <div class="flex-1 min-w-0">
            <div class="flex">
                <label class="pseudo-input cursor-not-allowed border-r-0 border border-black flex-1 min-w-0 flex items-center gap-2">
                    <span class="flex-0"> {% translate 'place (receiver)' %} </span>
                    <input type="text" class="grow cursor-not-allowed flex-1 min-w-0 truncate" disabled value="{{ object.receiver_place }}" />
                </label>
                <a class="btn flex-0 btn-outline border-black" href="{% url 'edwoca:letter_remove_receiver_place' object.id %}">{% translate 'remove' %}</a>
            </div>
        </div>
    {% else %}
        <div class="flex-1 min-w-0">
            <form method="get" class="flex m-0">
                <label class="input input-bordered bg-white border-r-0 border-black flex items-center gap-2 flex-1 min-w-0">
                    {% translate 'place (receiver)' %}
                    <input type="text" name="receiver_place-q" class="grow" {% if query_receiver_place %}value="{{ query_receiver_place }}"{% endif %}>
                </label>
                <input type="submit" class="btn flex-0 btn-outline border-black" value="{% translate 'search' %}"/>
            </form>
            {% if query_receiver_place %}
                <ul class="border border-black p-2 h-32 overflow-auto">
                {% for person in found_receiver_places %}
                    <li>
                        <a href="{% url 'edwoca:letter_add_receiver_place' object.id person.pk %}">{{ person.object }}</a>
                    </li>
                {% empty %}
                    <li>Keine Suchergebnisse</li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}
</div>

<h3>Editionen</h3>

<div class="my-5">
    {% for letter_mentioning_form in letter_mentioning_forms %}
        <div class="flex gap-5 items-center mb-2">
            <input type="text" value="{{ letter_mentioning_form.instance.bib.zot_short_title }} / {{ letter_mentioning_form.instance.bib }}" class="pseudo-input flex-1 border-black border w-full truncate" disabled />
            <label class="bg-white input input-bordered flex-0 flex items-center border-black gap-2 w-48">
                <span class="flex-0 min-w-0">
                    {% translate 'pages' %}
                </span>
                {{ letter_mentioning_form.pages }}
                {% if letter_mentioning_form.pages.errors %}
                    <div class="label">
                        <span class="label-text-alt text-primary">
                            {{ letter_mentioning_form.pages.errors.0 }}
                        </span>
                    </div>
                {% endif %}
            </label>
            <a href="{% url 'edwoca:letter_remove_edition' object.id letter_mentioning_form.instance.bib.zot_key %}" class="btn btn-outline flex-0"> {% translate 'remove' %} </a>
        </div>
    {% endfor %}
</div>

<div class="mb-10">
    <div class="items-center">
        <form method="get" class="flex">
            <label class="bg-white input input-bordered border-r-0 border-black flex items-center gap-2 flex-1">
                Edition
                <input type="text" name="edition-q" class="grow" {% if query_edition %}value="{{ query_edition }}"{% endif %}>
            </label>
            <input type="submit" class="btn btn-outline flex-0" value="{% translate 'search' %}"/>
        </form>
    </div>
    {% if query_edition %}
        <ul class="border border-black p-2 h-32 overflow-auto">
        {% for edition in found_editions %}
            <li>
                <a href="{% url 'edwoca:letter_add_edition' object.id edition.pk %}">{{ edition.object }}</a>
            </li>
        {% empty %}
            <li>Keine Suchergebnisse</li>
        {% endfor %}
        </ul>
    {% endif %}
</div>
{% endblock %}
